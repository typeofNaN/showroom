var k=Object.defineProperty;var v=(c,t,e)=>t in c?k(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var a=(c,t,e)=>(v(c,typeof t!="symbol"?t+"":t,e),e);import{l as x,b as S,m,bc as _,bd as C,bj as u,bn as p,bi as b,bo as f,ay as I}from"./index-207048c8.js";class P{constructor(t){a(this,"gobang",null);a(this,"context",null);a(this,"options",{role:1,canvas:null,gobangStyle:{padding:0,count:0}});a(this,"role",1);a(this,"win",!1);a(this,"history",[]);a(this,"currentStep",0);a(this,"gobangStyle",{padding:30,count:16});a(this,"lattice",{width:36,height:36});a(this,"checkerboard",[]);this.options=t,this.resetAndInit()}resetAndInit(){const{options:t}=this;this.role=t.role||this.role||1,this.win=!1,this.history=[],this.currentStep=0,this.gobang=null,this.gobang=t.canvas,this.gobang.width=600,this.gobang.height=600,this.context=this.gobang.getContext("2d",{willReadFrequently:!0}),this.context.strokeStyle="#aaa",this.context.lineWidth=1,this.gobang.onclick=null,this.context.fillStyle="#ddd",this.context.beginPath(),this.context.fillRect(0,0,this.gobang.clientWidth,this.gobang.clientHeight),this.context.closePath(),this.gobangStyle=Object.assign({padding:30,count:15},t.gobangStyle||{}),this.lattice={width:(this.gobang.clientWidth-this.gobangStyle.padding*2)/this.gobangStyle.count,height:(this.gobang.clientHeight-this.gobangStyle.padding*2)/this.gobangStyle.count},this.drawChessboard(),this.listenDownChessman(),this.initChessboardMatrix()}initChessboardMatrix(){const t=[];for(let e=0;e<this.gobangStyle.count+1;e++){t[e]=[];for(let i=0;i<this.gobangStyle.count+1;i++)t[e][i]=0}this.checkerboard=t}drawChessboard(){const{gobangStyle:t,context:e,lattice:i,gobang:n}=this;for(let o=0;o<=t.count;o++)e.moveTo(t.padding+o*i.width,t.padding),e.lineTo(t.padding+o*i.width,n.clientWidth-t.padding),e.stroke(),e.moveTo(t.padding,t.padding+o*i.height),e.lineTo(n.clientHeight-t.padding,t.padding+o*i.height),e.stroke();e.fillStyle="#000",[{x:n.clientWidth/2,y:n.clientHeight/2},{x:t.padding+4*i.width,y:t.padding+4*i.height},{x:t.padding+(t.count-4)*i.width,y:t.padding+4*i.height},{x:t.padding+4*i.width,y:t.padding+(t.count-4)*i.height},{x:t.padding+(t.count-4)*i.width,y:t.padding+(t.count-4)*i.height}].forEach(o=>{e.beginPath(),e.arc(o.x,o.y,i.width*.1,0,2*Math.PI),e.closePath(),e.fill()})}drawChessman(t,e,i){const{gobangStyle:n,context:o,lattice:r}=this;o.fillStyle=i?"#000":"#fff",o.beginPath(),o.arc(n.padding+t*r.width,n.padding+e*r.height,r.width*.4,0,2*Math.PI),o.closePath(),o.fill(),setTimeout(()=>{this.checkReferee(t,e,i?1:2)},0)}listenDownChessman(t=!1){this.gobang.onclick=e=>{let{offsetX:i,offsetY:n}=e;i=Math.floor((i-this.gobangStyle.padding/2)/this.lattice.width),n=Math.floor((n-this.gobangStyle.padding/2)/this.lattice.height),!!this.checkerboard[i]&&this.checkerboard[i][n]!==void 0&&Object.is(this.checkerboard[i][n],0)&&(this.checkerboard[i][n]=this.role,this.drawChessman(i,n,Object.is(this.role,1)),this.history.length=this.currentStep,this.history.push({x:i,y:n,role:this.role,snap:this.context.getImageData(0,0,this.gobang.clientWidth,this.gobang.clientHeight)}),this.currentStep++,this.role=Object.is(this.role,1)?2:1)}}checkReferee(t,e,i){var y;if(t==null||e==null||i==null)return;let n=0;const o=this.checkerboard.map(s=>s[e]),r=this.checkerboard[t],l=[],d=[];this.checkerboard.forEach((s,g)=>{const h=s[e-(t-g)];h!==void 0&&l.push(h);const w=s[e+(t-g)];w!==void 0&&d.push(w)}),[o,r,l,d].forEach(s=>{s.some((g,h)=>s[h]!==0&&s[h-2]===s[h-1]&&s[h-1]===s[h]&&s[h]===s[h+1]&&s[h+1]===s[h+2])&&n++}),n&&(this.gobang.onclick=null,this.win=!0,(y=window.$message)==null||y.success((i==1?"黑":"白")+"子胜，"+n+"杀！"))}regretChess(){if(this.history.length&&!this.win){const t=this.history[this.currentStep-2],e=this.history[this.currentStep-1];t&&t.snap&&(this.context.putImageData(t.snap,0,0),this.checkerboard[e.x][e.y]=0,this.currentStep--)}}revokedRegretChess(){const t=this.history[this.currentStep];t&&t.snap&&(this.context.putImageData(t.snap,0,0),this.checkerboard[t.x][t.y]=t.role,this.currentStep++)}}const R={class:"h-full"},B={class:"h-full flex-center flex-col bg-#ccc rounded-8px overflow-hidden"},M={class:"mt-30px w-400px flex flex-justify-between"},W=x({__name:"index",setup(c){const t=S(),e=S();m(()=>{e.value=new P({role:2,canvas:t.value,gobangStyle:{padding:30,count:16}})});function i(){e.value.resetAndInit()}function n(){e.value.regretChess()}function o(){e.value.revokedRegretChess()}return(r,l)=>{const d=I;return _(),C("div",R,[u("div",B,[u("canvas",{ref_key:"canvasRef",ref:t,width:"600px",height:"600px"},null,512),u("div",M,[p(d,{type:"primary",onClick:i},{default:b(()=>[f("开始/重置")]),_:1}),p(d,{type:"warning",onClick:n},{default:b(()=>[f("悔棋")]),_:1}),p(d,{type:"error",onClick:o},{default:b(()=>[f("撤销悔棋")]),_:1})])])])}}});export{W as default};
